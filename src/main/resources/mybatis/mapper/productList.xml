<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skkcandle.dao.ProductListDao">		
	
	<select id="selectByProductId" resultType="ProductList">
		SELECT p.productid, p.productname, p.productstock, p.productmaker, p.productprice, pi.productimage
		FROM product p INNER JOIN productImages pi
		ON p.productId = pi.productId
		WHERE pi.usage='thumbnail' 
		ORDER BY p.productId desc
	</select>
	
	<select id="getProductListByReviewCount" resultType="ProductList">
		<![CDATA[
			SELECT
			    p.productid,
			    p.productname,
			    p.productprice,
			    p.productstock,
			    p.productmaker,
			    (SELECT COUNT(*) FROM review r WHERE r.productid = p.productid) AS reviewCount,
			    th.productimage
			FROM product p
			inner JOIN productimages th ON th.productId = p.productid AND th.usage = 'thumbnail'
			ORDER BY reviewCount DESC
			FETCH FIRST 3 ROWS ONLY
		]]>
	</select>
	
</mapper>
